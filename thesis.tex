\documentclass[12pt,draft]{reedthesis}

\overfullrule=1mm

% Core packages
\usepackage[intlimits]{mathtools} % Load before newtxmath
\mathtoolsset{%
  mathic,
}
\usepackage{physics}
\usepackage{siunitx}
\usepackage[numbers]{natbib}

\usepackage{ifdraft} % final: for printing (set bw, etc.)
\usepackage{subfiles}

\AtEndDocument{%
  \bibliographystyle{unsrtnat}
  \bibliography{thesis}
}

% Layout and styling
\usepackage[final]{microtype}
\usepackage{setspace} 
\usepackage{booktabs}

\usepackage{sectsty}
\allsectionsfont{\normalfont\sffamily\liningnums}

\usepackage{amsthm}
\theoremstyle{plain}
\newtheorem{thm}{Theorem}[section]
\newtheorem{lem}{Lemma}
\theoremstyle{definition}
\newtheorem{defn}{Definition}
\newtheorem{post}{Postulate}

\setlength{\parskip}{0pt}

% Graphics
\usepackage{graphicx}
% \usepackage[usenames,dvipsnames]{xcolor}
% \usepackage{tikz}

% Fonts
\usepackage{fontspec}
\usepackage[semibold,osf]{libertinus}
\usepackage[scr=boondoxo,cal=esstix]{mathalfa}
\usepackage{bm} % Load after math font configuration
\renewcommand\mathrm\textnormal%
\setmonofont[Scale=MatchLowercase]{Inconsolata}

\usepackage{lettrine}
% \usepackage{Zallman} % Even fancier
% \renewcommand\LettrineFontHook{\Zallmanfamily}
% \newcommand{\dropcap}[2]{\lettrine{#1}{#2}}
\newcommand{\dropcap}[2]{\textsc{#1#2}}

\usepackage[switch*,pagewise]{lineno} % Before minted
\ifdraft{\linenumbers}{}

% Patch amsmath environments to work with lineno
\newcommand*\patchAmsMathEnvironmentForLineno[1]{%
  \expandafter\let\csname old#1\expandafter\endcsname\csname #1\endcsname
  \expandafter\let\csname oldend#1\expandafter\endcsname\csname end#1\endcsname
  \renewenvironment{#1}%
  {\linenomath\csname old#1\endcsname}%
{\csname oldend#1\endcsname\endlinenomath}}%
\newcommand*\patchBothAmsMathEnvironmentsForLineno[1]{%
  \patchAmsMathEnvironmentForLineno{#1}%
\patchAmsMathEnvironmentForLineno{#1*}}%
\AtBeginDocument{%
  \patchBothAmsMathEnvironmentsForLineno{equation}%
  \patchBothAmsMathEnvironmentsForLineno{align}%
  \patchBothAmsMathEnvironmentsForLineno{flalign}%
  \patchBothAmsMathEnvironmentsForLineno{alignat}%
  \patchBothAmsMathEnvironmentsForLineno{gather}%
  \patchBothAmsMathEnvironmentsForLineno{multline}%
}

% Code highlighting
\usepackage{minted}
\setminted{%
  mathescape,
  linenos,
  breaklines,
  fontsize=\small,
}
\setminted[wolfram]{style=mathematica}
\ifoptionfinal{\setminted{style=bw}}{\setminted{style=friendly}}

% Other
\usepackage{kantlipsum}
% \ifdraft{\usepackage{draftwatermark}\SetWatermarkColor[gray]{0.95}}{}

% Reference management (order-sensitive)
\usepackage[pdfusetitle,final,backref]{hyperref}
\usepackage[all]{hypcap}
\usepackage{cleveref}
\usepackage{autonum}
\hypersetup{%
  allcolors=MidnightBlue,
  citecolor=OliveGreen,
  urlcolor=MidnightBlue,
}
\urlstyle{same}
\ifoptionfinal{\hypersetup{hidelinks}}{\hypersetup{colorlinks}}


% Resources
\graphicspath{{figs/}}


% Math commands
% Subscript text
\newcommand*\sub[1]{\textit{#1}}

% Variant symbols
\renewcommand\leq\leqslant%
\renewcommand\geq\geqslant%
\renewcommand\phi\varphi%
\renewcommand\epsilon\varepsilon%

% Common algebraic objects
\newcommand\ZZ{\mathbb{Z}}
\newcommand\QQ{\mathbb{Q}}
\newcommand\CC{\mathbb{C}}
\newcommand\RR{\mathbb{R}}

% Named operations and special constants
\newcommand\im{\mathrm{i}\mkern1mu}
\renewcommand\ln{\operatorname{\mathrm{ln}}}
\renewcommand\log{\operatorname{\mathrm{log}}}
\renewcommand\exp{\operatorname{\mathrm{exp}}}
\renewcommand\tr{\operatorname{\mathrm{tr}}}
\renewcommand\det{\operatorname{\mathrm{det}}}

% Operators
\newcommand\tp\otimes%
\newcommand{\opr}[1]{\mathsf{#1}}%
\newcommand\idsopr{\mathbb{1}}
\newcommand\idopr{\opr{I}}
\newcommand\sopr\mathcal%
\newcommand\herm{\operatorname{\mathrm{He}}}

% Categories
\newcommand\cat\mathsf%

% Quantum mechanics
\newcommand\hilb{\mathcal{H}}
\newcommand\liou{\mathcal{L}}
\newcommand\ham{\opr{H}}
\newcommand\dop{\opr{œÅ}}
\newcommand\tprod\otimes%
\newcommand\lprod\ip%
\newcommand\ensavg[2][\dop]{\ev{#2}_{\mkern-1.5mu{#1}}}
\newcommand\sensavg[2][\dop]{\ev*{#2}_{\mkern-1.5mu{#1}}}

  \title{\textbf{\large
      Toy Systems and Quantum Master Equations
    }\ifdraft{\\\textsc{(Provisional Title) \textbf{Draft}}}{}
    }
\author{Alex Striff}
% The month and year that you submit your final draft to the library
% (May or December)
\date{\ifoptionfinal{May 2021}{\today}}
\division{Mathematics and Natural Sciences}
\advisor{Advisor F. Name}
\department{Physics}

\begin{document}
\maketitle
\pagenumbering{roman}
\frontmatter
\pagenumbering{arabic}
\pagestyle{empty}

\subfile{acknowledgements}
% \chapter*{Preface} % Optional
\subfile{abstract}
% \chapter*{Dedication} % Optional

\mainmatter%
\pagestyle{fancyplain}
\tableofcontents
% \listoffigures
% \listoftables

% \ifdraft{\setstretch{1.5}}{}

\subfile{introduction}
\subfile{dop-theory/main}
\subfile{conclusion}

\appendix
\subfile{appendix}

\backmatter% Adds index and bibliography to TOC

% Bibliography added by \AtEndDocument in preamble so that subfiles have
% bibliographies.

\end{document}

